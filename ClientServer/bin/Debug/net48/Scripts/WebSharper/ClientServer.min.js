(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N;a=self;b=a.testFrom0=a.testFrom0||{};c=b.Client=b.Client||{};d=c.JHelper=c.JHelper||{};e=a.StartupCode$ClientServer$Client=a.StartupCode$ClientServer$Client||{};f=a.ClientServer_JsonEncoder=a.ClientServer_JsonEncoder||{};g=a.GeneratedPrintf=a.GeneratedPrintf||{};h=a.ClientServer_JsonDecoder=a.ClientServer_JsonDecoder||{};i=a.WebSharper;j=i&&i.Unchecked;k=i&&i.JavaScript;l=k&&k.Pervasives;m=i&&i.UI;n=m&&m.Next;o=n&&n.Var;p=i&&i.Html;q=p&&p.Client;r=q&&q.Tags;s=i&&i.Concurrency;t=i&&i.Owin;u=t&&t.WebSocket;v=u&&u.Client;w=v&&v.WithEncoding;x=a.JSON;y=a.IntelliFactory;z=y&&y.Runtime;A=i&&i.Utils;B=a.jQuery;C=i&&i.Remoting;D=C&&C.AjaxRemotingProvider;E=i&&i.ClientSideJson;F=E&&E.Provider;G=i&&i.Strings;H=i&&i.Arrays;I=n&&n.Submitter;J=n&&n.View;K=i&&i.Seq;L=i&&i.MatchFailureException;M=n&&n.Doc;N=n&&n.AttrProxy;d.append=function(O,P,Q){O[P]=d.add((j.Equals(l.GetJS(O,[P]),void 0)?O[P]=[]:void 0,O[P]),Q);return O;};d.add=function(O,P){return O.concat(P);};c.Send=function(O){var P,Q;function R(S){return S(function(T){o.Set(c.filterResult(),c.filterResult().c.concat([T+"\n"]));P.Dom.appendChild(self.document.createTextNode(T+"\n"));});}P=r.Tags().NewTag("pre",[]);s.Start((Q=null,s.Delay(function(){return s.Bind(w.ConnectStateful(function(S){return x.stringify((f.j())(S));},function(S){return(h.j())(x.parse(S));},O,function(){var S;S=null;return s.Delay(function(){return s.Return([0,function(T){return function(U){var V;V=null;return s.Delay(function(){var W,X;return U.$==3?(R(function(Y){return Y("WebSocket connection closed.");}),s.Return(T)):U.$==2?(R(function(Y){return Y("WebSocket connection open.");}),s.Return(T)):U.$==1?(R(function(Y){return Y("WebSocket connection error!");}),s.Return(T)):(W=U.$0,s.Combine(W.$==3?(X=new a.Date(),((((R(z.Curried(function(Y,Z,_0,_1){return Y("["+A.toSafe(Z)+"]["+a.String(_0)+"] "+A.toSafe(_1));},4)))(X.toTimeString()))(T))(W.$0),s.Zero())):(R(function(Y){return Y("invalidMessage");}),s.Zero()),s.Delay(function(){return s.Return(T+1);})));});};}]);});}),function(S){S.Post({$:3,$0:"kickOff"});return s.Zero();});})),null);P.HtmlProvider.SetAttribute(P.get_Body(),"id","console");return P;};c.WS=function(O){var P,Q;function R(S){return S(function(T){P.Dom.appendChild(self.document.createTextNode(T+"\n"));});}P=r.Tags().NewTag("pre",[]);s.Start((Q=null,s.Delay(function(){var S;R(function(T){return T("Checking regression #4...");});B.ajax((S={},S.url="/ws.txt",S.method="GET",S.success=function(T){return(R(function(U){return function(V){return U(A.toSafe(V));};}))(T);},S.error=function(T,U,V){return(R(function(W){return function(X){return W("KO: "+A.toSafe(X)+".");};}))(V);},S));return s.Bind(w.ConnectStateful(function(T){return x.stringify((f.j())(T));},function(T){return(h.j())(x.parse(T));},O,function(){var T;T=null;return s.Delay(function(){return s.Return([0,function(U){return function(V){var W;W=null;return s.Delay(function(){var X;return V.$==3?(R(function(Y){return Y("WebSocket connection closed.");}),s.Return(U)):V.$==2?(R(function(Y){return Y("WebSocket connection open.");}),s.Return(U)):V.$==1?(R(function(Y){return Y("WebSocket connection error!");}),s.Return(U)):(X=V.$0,s.Combine(X.$==0?(((R(z.Curried3(function(Y,Z,_0){return Y("Response2 "+a.String(Z)+" (state: "+a.String(_0)+")");})))(X.$0))(U),s.Zero()):X.$==2?((R(function(Y){return function(Z){return Y("Resp3 "+g.p(Z));};}))(X.$0),s.Zero()):X.$==3?((R(function(Y){return function(Z){return Y("MessageFromServer_String "+A.prettyPrint(Z));};}))(X.$0),s.Zero()):(((R(z.Curried3(function(Y,Z,_0){return Y("Response1 "+A.toSafe(Z)+" (state: "+a.String(_0)+")");})))(X.$0))(U),s.Zero()),s.Delay(function(){return s.Return(U+1);})));});};}]);});}),function(T){var U;U=T.get_Connection();return s.While(function(){return true;},s.Delay(function(){return s.Bind(s.Sleep(1000),function(){U.send(x.stringify((f.j())({$:2,$0:{name:{"first-name":"John00",LastName:"Doe"},age:42}})));return s.Zero();});}));});})),null);return P;};c.fsiCmd=function(){var O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4;function _5(_6){var _7,_8;return _6!=null&&_6.$==1?(_7=_6.$0,(o.Set(P,P.c.concat([_7])),o.Set(Z,Z.c+1),(new D.New()).Async("ClientServer:testFrom0.Server.fsiExecute:-1840423385",[_7]))):(_8=null,s.Delay(function(){return s.Return("");}));}O=o.Create$1("");P=o.Create$1([]);Q={g:[]};x.parse("123");R=(S=Q.g,[x.parse("123")].concat(S));a.alert(x.stringify(((F.EncodeArray(F.Id()))())(R)));a.alert((T=d.add(x.parse("[123]"),x.parse("[456]")),x.stringify(((F.EncodeArray(F.Id()))())(T))));a.alert((U=d.append(Q,"ttc",x.parse("[789]")),x.stringify(((F.Id())())(U))));V=o.Lens(c.filterResult(),function(_6){var _7;_7=new a.RegExp(c.filterKeyWord().c);return G.concat("",H.filter(function(_8){return _7.test(_8);},_6));},function(_6,_7){return _6.concat([_7]);});W=o.Create$1("named script");X=o.Create$1("");Y=o.Create$1("http://localhost:8080/");Z=o.Create$1(0);_0=I.CreateOption(O.v);_1=I.CreateOption(X.v);_2=I.CreateOption(P.v);_3=J.Map(function(_6){return K.nth(0,_6)+" "+K.nth(1,_6);},J.Sequence([J.MapAsync(_5,_0.view),J.MapAsync(_5,_1.view)]));J.MapAsync(function(_6){var _7,_8;if(_6!=null&&_6.$==1){if(H.length(_6.$0)===0)return(new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);else if(_6!=null&&_6.$==1){_7=_6.$0;_8=null;return s.Delay(function(){return s.Return(_7);});}else throw new L.New("Client.fs",262,33);}else return(new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);},_2.view);_4=M.Input([N.Create("id","fKW"),N.Create("style","width: 880px"),N.Create("class","input"),N.Create("rows","1")],c.filterKeyWord()).on("blur",function(){return B("#filteredResult").val(V.RVal());});return M.Element("div",[],[M.Element("div",[],[M.Button("Send",[],function(){_0.Trigger();}),M.Button("SendSingle",[],function(){_1.Trigger();}),M.Button("Clear Console",[],function(){B("#console").empty();}),M.Button("Clear Command",[],function(){B("#fsiCmd").val("");}),M.Button("Last Command",[],function(){var _6;s.Start((_6=null,s.Delay(function(){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getHisCmd:-447555547",[]),function(_7){B("#fsiCmd").val(_7);return s.Zero();});})),null);}),M.Button("Previous Command",[],function(){var _6;H.length(P.c)===0?s.Start((_6=null,s.Delay(function(){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]),function(_7){o.Set(P,_7);return s.Combine(H.length(P.c)>0?(o.Set(Z,H.length(P.c)-1),s.Zero()):s.Zero(),s.Delay(function(){o.Set(O,H.get(P.c,Z.c));return s.Zero();}));});})),null):(Z.c===0?o.Set(Z,H.length(P.c)-1):o.Set(Z,Z.c-1),o.Set(O,H.get(P.c,Z.c)));_2.Trigger();}),M.Button("Get Script",[],function(){var _6;s.Start((_6=null,s.Delay(function(){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getNamedScript:-1840423385",[a.String(B("#nScript").val())]),function(_7){B("#fsiCmd").val(_7);return s.Zero();});})),null);}),M.Button("Save Script",[],function(){var _6;s.Start((_6=null,s.Delay(function(){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.upsertNamedScript:2040152023",[a.String(B("#nScript").val()),a.String(B("#fsiCmd").val())]),function(_7){B("#fsiCmd").val(_7);return s.Zero();});})),null);}),M.Button("List Script",[],function(){var _6;s.Start((_6=null,s.Delay(function(){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.listNamedScripts:-118046996",[]),function(_7){var _8;_8=H.fold(function(_9,_){return _9!==""?_9+"\r\n"+_:_;},"",_7);B("#nScript").val("");B("#fsiCmd").val(_8);return s.Zero();});})),null);}),M.Button("Clear Result Cache",[],function(){o.Set(c.filterResult(),[]);}),M.Element("br",[],[]),M.Button("ConnectTo",[],function(){s.Start(c.Send3(a.String(B("#webSocket2").val())),null);}),M.Element("br",[],[]),M.InputArea([N.Create("id","webSocket2"),N.Create("style","width: 880px"),N.Create("class","input"),N.Create("rows","1")],Y),M.Element("br",[],[]),_4,M.InputArea([N.Create("id","nScript"),N.Create("style","width: 880px"),N.Create("class","input"),N.Create("rows","1")],W),M.InputArea([N.Create("id","fsiCmd"),N.Create("style","width: 880px"),N.Create("class","input"),N.Create("rows","10"),N.Create("value","printfn \"orz\"")],O),M.InputArea([N.Create("id","singleCmd"),N.Create("style","width: 880px"),N.Create("class","input"),N.Create("rows","1")],X)]),M.Element("hr",[],[]),M.InputArea([N.Create("id","filteredResult"),N.Create("style","width: 880px"),N.Create("class","input"),N.Create("rows","10")],V),M.Element("h4",[N.Create("class","text-muted")],[M.TextNode("The server responded:")]),M.Element("div",[],[M.Element("h1",[],[M.TextView(_3)])])]);};c.Send3=function(O){var P;!j.Equals(c.socketServer().c,null)?c.socketServer().c.$0.get_Connection().close():void 0;P=null;return s.Delay(function(){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.MD5Hash:-1840423385",[O]),function(Q){return s.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getPort:1510873242",[O]),function(R){B("#console").empty().ready(function(){return c.Send2(R,Q);});return s.Zero();});});});};c.Send2=function(O,P){var Q;function R(S){return S(function(T){o.Set(c.filterResult(),c.filterResult().c.concat([T+"\n"]));M.RunAppendById("console",M.TextNode(T+"\n"));});}s.Start((Q=null,s.Delay(function(){return s.Bind(w.ConnectStateful(function(S){return x.stringify((f.j())(S));},function(S){return(h.j())(x.parse(S));},O,function(){var S;S=null;return s.Delay(function(){return s.Return([0,function(T){return function(U){var V;V=null;return s.Delay(function(){var W,X;return U.$==3?(R(function(Y){return Y("WebSocket connection closed.");}),s.Return(T)):U.$==2?(R(function(Y){return Y("WebSocket connection open.");}),s.Return(T)):U.$==1?(R(function(Y){return Y("WebSocket connection error!");}),s.Return(T)):(W=U.$0,s.Combine(W.$==3?(X=new a.Date(),((((((((((R(z.Curried(function(Y,Z,_0,_1,_2,_3,_4,_5,_6,_7){return Y("["+A.toSafe(Z)+"]["+a.String(_0)+"-"+a.String(_1)+"-"+a.String(_2)+" "+a.String(_3)+":"+a.String(_4)+":"+a.String(_5)+"]["+a.String(_6)+"] "+A.toSafe(_7));},10)))(P))(X.getFullYear()))(X.getMonth()))(X.getUTCDay()))(X.getUTCHours()))(X.getUTCHours()))(X.getUTCSeconds()))(T))(W.$0),s.Zero())):(R(function(Y){return Y("invalidMessage");}),s.Zero()),s.Delay(function(){return s.Return(T+1);})));});};}]);});}),function(S){o.Set(c.socketServer(),{$:1,$0:S});S.Post({$:3,$0:"kickOff"});return s.Zero();});})),null);};c.socketServer=function(){e.$cctor();return e.socketServer;};c.content=function(){e.$cctor();return e.content;};c.filterKeyWord=function(){e.$cctor();return e.filterKeyWord;};c.filterResult=function(){e.$cctor();return e.filterResult;};c.m2=function(){var O,P,Q;O=o.Create$1("orz");P=J.Map(function(R){return(function(S){return function(T){return S("You entered "+a.String(T)+" characters.");};}(a.id))(R);},J.Map(G.length,O.v));Q=M.BindView(function(R){return M.Concat(H.map(function(S){return M.Element("li",[],[M.TextNode(S)]);},R));},J.Map(function(R){return G.SplitChars(R,[" "],0);},O.v));return M.Element("div",[],[M.Element("div",[],[M.Input([],O),M.TextView(P)]),M.Element("div",[],[M.TextNode("You entered the following words:"),M.Element("ul",[],[Q])])]);};c.Main=function(){var O,P,Q;O=o.Create$1("");P=I.CreateOption(O.v);Q=J.MapAsync(function(R){var S;return R!=null&&R.$==1?(new D.New()).Async("ClientServer:testFrom0.Server.DoSomething:-1840423385",[R.$0]):(S=null,s.Delay(function(){return s.Return("");}));},P.view);M.RunById("navbar",M.Element("div",[],[M.TextNode("This goes into #main.")]));return M.Element("div",[],[M.Input([],O),M.Button("Send",[],function(){P.Trigger();}),M.Element("hr",[],[]),M.Element("h4",[N.Create("class","text-muted")],[M.TextNode("The server responded:")]),M.Element("div",[N.Create("class","jumbotron")],[M.Element("h1",[],[M.TextView(Q)])])]);};e.$cctor=function(){e.$cctor=a.ignore;e.filterResult=o.Create$1([]);e.filterKeyWord=o.Create$1("");e.content=o.Create$1("");e.socketServer=o.Create$1(null);};f.j=function(){return f._v?f._v:f._v=(F.EncodeUnion(void 0,{cmd:3,age:2,"int":1,str:0},[["Request1",[["$0","str",F.EncodeArray(F.Id()),0]]],["Request2",[["$0","int",F.EncodeArray(F.Id()),0]]],["Req3",[[null,true,F.Id()]]],["MessageFromClient",[["$0","cmd",F.Id(),0]]]]))();};g.p=function(O){return"{"+("FirstName = "+A.prettyPrint(O["first-name"]))+"; "+("LastName = "+A.prettyPrint(O.LastName))+"}";};h.j=function(){return h._v?h._v:h._v=(F.DecodeUnion(void 0,"type",[["int",[["$0","value",F.Id(),0]]],["string",[["$0","value",F.Id(),0]]],["name",[["$0","value",F.Id(),0]]],["msgStr",[["$0","value",F.Id(),0]]]]))();};}());
