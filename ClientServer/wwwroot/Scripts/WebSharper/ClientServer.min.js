(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J;a=self;b=a.testFrom0=a.testFrom0||{};c=b.Client=b.Client||{};d=a.StartupCode$ClientServer$Client=a.StartupCode$ClientServer$Client||{};e=a.GeneratedPrintf=a.GeneratedPrintf||{};f=a.ClientServer_JsonEncoder=a.ClientServer_JsonEncoder||{};g=a.ClientServer_JsonDecoder=a.ClientServer_JsonDecoder||{};h=a.WebSharper;i=h&&h.UI;j=i&&i.Next;k=j&&j.Var;l=h&&h.Html;m=l&&l.Client;n=m&&m.Tags;o=h&&h.Concurrency;p=h&&h.Owin;q=p&&p.WebSocket;r=q&&q.Client;s=r&&r.WithEncoding;t=a.JSON;u=a.IntelliFactory;v=u&&u.Runtime;w=h&&h.Utils;x=a.jQuery;y=h&&h.Strings;z=h&&h.Arrays;A=j&&j.Submitter;B=j&&j.View;C=h&&h.Remoting;D=C&&C.AjaxRemotingProvider;E=h&&h.MatchFailureException;F=j&&j.Doc;G=j&&j.AttrProxy;H=h&&h.Unchecked;I=h&&h.ClientSideJson;J=I&&I.Provider;c.Send=function(K){var L,M;function N(O){return O(function(P){k.Set(c.filterResult(),c.filterResult().c.concat([P+"\n"]));L.Dom.appendChild(self.document.createTextNode(P+"\n"));});}L=n.Tags().NewTag("pre",[]);o.Start((M=null,o.Delay(function(){return o.Bind(s.ConnectStateful(function(O){return t.stringify((f.j())(O));},function(O){return(g.j())(t.parse(O));},K,function(){var O;O=null;return o.Delay(function(){return o.Return([0,function(P){return function(Q){var R;R=null;return o.Delay(function(){var S;return Q.$==3?(N(function(T){return T("WebSocket connection closed.");}),o.Return(P)):Q.$==2?(N(function(T){return T("WebSocket connection open.");}),o.Return(P)):Q.$==1?(N(function(T){return T("WebSocket connection error!");}),o.Return(P)):(S=Q.$0,o.Combine(S.$==3?(((N(v.Curried3(function(T,U,V){return T("MessageFromServer_String "+w.toSafe(U)+" \r\n(state: "+a.String(V)+")");})))(S.$0))(P),o.Zero()):(N(function(T){return T("invalidMessage");}),o.Zero()),o.Delay(function(){return o.Return(P+1);})));});};}]);});}),function(O){O.Post({$:3,$0:"kickOff"});return o.Zero();});})),null);L.HtmlProvider.SetAttribute(L.get_Body(),"id","console");return L;};c.WS=function(K){var L,M;function N(O){return O(function(P){L.Dom.appendChild(self.document.createTextNode(P+"\n"));});}L=n.Tags().NewTag("pre",[]);o.Start((M=null,o.Delay(function(){var O;N(function(P){return P("Checking regression #4...");});x.ajax((O={},O.url="/ws.txt",O.method="GET",O.success=function(P){return(N(function(Q){return function(R){return Q(w.toSafe(R));};}))(P);},O.error=function(P,Q,R){return(N(function(S){return function(T){return S("KO: "+w.toSafe(T)+".");};}))(R);},O));return o.Bind(s.ConnectStateful(function(P){return t.stringify((f.j())(P));},function(P){return(g.j())(t.parse(P));},K,function(){var P;P=null;return o.Delay(function(){return o.Return([0,function(Q){return function(R){var S;S=null;return o.Delay(function(){var T;return R.$==3?(N(function(U){return U("WebSocket connection closed.");}),o.Return(Q)):R.$==2?(N(function(U){return U("WebSocket connection open.");}),o.Return(Q)):R.$==1?(N(function(U){return U("WebSocket connection error!");}),o.Return(Q)):(T=R.$0,o.Combine(T.$==0?(((N(v.Curried3(function(U,V,W){return U("Response2 "+a.String(V)+" (state: "+a.String(W)+")");})))(T.$0))(Q),o.Zero()):T.$==2?((N(function(U){return function(V){return U("Resp3 "+e.p(V));};}))(T.$0),o.Zero()):T.$==3?((N(function(U){return function(V){return U("MessageFromServer_String "+w.prettyPrint(V));};}))(T.$0),o.Zero()):(((N(v.Curried3(function(U,V,W){return U("Response1 "+w.toSafe(V)+" (state: "+a.String(W)+")");})))(T.$0))(Q),o.Zero()),o.Delay(function(){return o.Return(Q+1);})));});};}]);});}),function(P){var Q;Q=P.get_Connection();return o.While(function(){return true;},o.Delay(function(){return o.Bind(o.Sleep(1000),function(){Q.send(t.stringify((f.j())({$:2,$0:{name:{"first-name":"John00",LastName:"Doe"},age:42}})));return o.Zero();});}));});})),null);return L;};c.fsiCmd=function(){var K,L,M,N,O,P,Q,R,S,T;K=k.Create$1("");L=k.Create$1([]);M=k.Lens(c.filterResult(),function(U){var V;V=new a.RegExp(c.filterKeyWord().c);return y.concat("",z.filter(function(W){return V.test(W);},U));},function(U,V){return U.concat([V]);});N=k.Create$1("named script");O=k.Create$1("http://localhost:8080/");P=k.Create$1(0);Q=A.CreateOption(K.v);R=A.CreateOption(L.v);S=B.MapAsync(function(U){var V,W;return U!=null&&U.$==1?(V=U.$0,(k.Set(L,L.c.concat([V])),k.Set(P,P.c+1),(new D.New()).Async("ClientServer:testFrom0.Server.fsiExecute:-1840423385",[V]))):(W=null,o.Delay(function(){return o.Return("");}));},Q.view);B.MapAsync(function(U){var V,W;if(U!=null&&U.$==1){if(z.length(U.$0)===0)return(new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);else if(U!=null&&U.$==1){V=U.$0;W=null;return o.Delay(function(){return o.Return(V);});}else throw new E.New("Client.fs",218,33);}else return(new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);},R.view);T=F.Input([G.Create("id","fKW"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","1")],c.filterKeyWord()).on("blur",function(){return x("#filteredResult").val(M.RVal());});return F.Element("div",[],[F.Element("div",[],[F.Button("Send",[],function(){Q.Trigger();}),F.Button("Clear Console",[],function(){x("#console").empty();}),F.Button("Clear Command",[],function(){x("#fsiCmd").val("");}),F.Button("Last Command",[],function(){var U;o.Start((U=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getHisCmd:-447555547",[]),function(V){x("#fsiCmd").val(V);return o.Zero();});})),null);}),F.Button("Previous Command",[],function(){var U;z.length(L.c)===0?o.Start((U=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]),function(V){k.Set(L,V);return o.Combine(z.length(L.c)>0?(k.Set(P,z.length(L.c)-1),o.Zero()):o.Zero(),o.Delay(function(){k.Set(K,z.get(L.c,P.c));return o.Zero();}));});})),null):(P.c===0?k.Set(P,z.length(L.c)-1):k.Set(P,P.c-1),k.Set(K,z.get(L.c,P.c)));R.Trigger();}),F.Button("Get Script",[],function(){var U;o.Start((U=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getNamedScript:-1840423385",[a.String(x("#nScript").val())]),function(V){x("#fsiCmd").val(V);return o.Zero();});})),null);}),F.Button("Save Script",[],function(){var U;o.Start((U=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.upsertNamedScript:2040152023",[a.String(x("#nScript").val()),a.String(x("#fsiCmd").val())]),function(V){x("#fsiCmd").val(V);return o.Zero();});})),null);}),F.Button("List Script",[],function(){var U;o.Start((U=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.listNamedScripts:-118046996",[]),function(V){var W;W=z.fold(function(X,Y){return X!==""?X+"\r\n"+Y:Y;},"",V);x("#nScript").val("");x("#fsiCmd").val(W);return o.Zero();});})),null);}),F.Button("Clear Result Cache",[],function(){k.Set(c.filterResult(),[]);}),F.Element("br",[],[]),F.Button("ConnectTo",[],function(){o.Start(c.Send3(a.String(x("#webSocket2").val())),null);}),F.Element("br",[],[]),F.InputArea([G.Create("id","webSocket2"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","1")],O),F.Element("br",[],[]),T,F.InputArea([G.Create("id","nScript"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","1")],N),F.InputArea([G.Create("id","fsiCmd"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","10"),G.Create("value","printfn \"orz\"")],K)]),F.Element("hr",[],[]),F.InputArea([G.Create("id","filteredResult"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","10")],M),F.Element("h4",[G.Create("class","text-muted")],[F.TextNode("The server responded:")]),F.Element("div",[],[F.Element("h1",[],[F.TextView(S)])])]);};c.Send3=function(K){var L;!H.Equals(c.socketServer().c,null)?c.socketServer().c.$0.get_Connection().close():void 0;L=null;return o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getPort:1510873242",[K]),function(M){x("#console").empty().ready(function(){return c.Send2(M);});return o.Zero();});});};c.Send2=function(K){var L;function M(N){return N(function(O){k.Set(c.filterResult(),c.filterResult().c.concat([O+"\n"]));F.RunAppendById("console",F.TextNode(O+"\n"));});}o.Start((L=null,o.Delay(function(){return o.Bind(s.ConnectStateful(function(N){return t.stringify((f.j())(N));},function(N){return(g.j())(t.parse(N));},K,function(){var N;N=null;return o.Delay(function(){return o.Return([0,function(O){return function(P){var Q;Q=null;return o.Delay(function(){var R;return P.$==3?(M(function(S){return S("WebSocket connection closed.");}),o.Return(O)):P.$==2?(M(function(S){return S("WebSocket connection open.");}),o.Return(O)):P.$==1?(M(function(S){return S("WebSocket connection error!");}),o.Return(O)):(R=P.$0,o.Combine(R.$==3?(((M(v.Curried3(function(S,T,U){return S("MessageFromServer_String "+w.toSafe(T)+" \r\n(state: "+a.String(U)+")");})))(R.$0))(O),o.Zero()):(M(function(S){return S("invalidMessage");}),o.Zero()),o.Delay(function(){return o.Return(O+1);})));});};}]);});}),function(N){k.Set(c.socketServer(),{$:1,$0:N});N.Post({$:3,$0:"kickOff"});return o.Zero();});})),null);};c.socketServer=function(){d.$cctor();return d.socketServer;};c.content=function(){d.$cctor();return d.content;};c.filterKeyWord=function(){d.$cctor();return d.filterKeyWord;};c.filterResult=function(){d.$cctor();return d.filterResult;};c.m2=function(){var K,L,M;K=k.Create$1("orz");L=B.Map(function(N){return(function(O){return function(P){return O("You entered "+a.String(P)+" characters.");};}(a.id))(N);},B.Map(y.length,K.v));M=F.BindView(function(N){return F.Concat(z.map(function(O){return F.Element("li",[],[F.TextNode(O)]);},N));},B.Map(function(N){return y.SplitChars(N,[" "],0);},K.v));return F.Element("div",[],[F.Element("div",[],[F.Input([],K),F.TextView(L)]),F.Element("div",[],[F.TextNode("You entered the following words:"),F.Element("ul",[],[M])])]);};c.Main=function(){var K,L,M;K=k.Create$1("");L=A.CreateOption(K.v);M=B.MapAsync(function(N){var O;return N!=null&&N.$==1?(new D.New()).Async("ClientServer:testFrom0.Server.DoSomething:-1840423385",[N.$0]):(O=null,o.Delay(function(){return o.Return("");}));},L.view);F.RunById("navbar",F.Element("div",[],[F.TextNode("This goes into #main.")]));return F.Element("div",[],[F.Input([],K),F.Button("Send",[],function(){L.Trigger();}),F.Element("hr",[],[]),F.Element("h4",[G.Create("class","text-muted")],[F.TextNode("The server responded:")]),F.Element("div",[G.Create("class","jumbotron")],[F.Element("h1",[],[F.TextView(M)])])]);};d.$cctor=function(){d.$cctor=a.ignore;d.filterResult=k.Create$1([]);d.filterKeyWord=k.Create$1("");d.content=k.Create$1("");d.socketServer=k.Create$1(null);};e.p=function(K){return"{"+("FirstName = "+w.prettyPrint(K["first-name"]))+"; "+("LastName = "+w.prettyPrint(K.LastName))+"}";};f.j=function(){return f._v?f._v:f._v=(J.EncodeUnion(void 0,{cmd:3,age:2,"int":1,str:0},[["Request1",[["$0","str",J.EncodeArray(J.Id()),0]]],["Request2",[["$0","int",J.EncodeArray(J.Id()),0]]],["Req3",[[null,true,J.Id()]]],["MessageFromClient",[["$0","cmd",J.Id(),0]]]]))();};g.j=function(){return g._v?g._v:g._v=(J.DecodeUnion(void 0,"type",[["int",[["$0","value",J.Id(),0]]],["string",[["$0","value",J.Id(),0]]],["name",[["$0","value",J.Id(),0]]],["msgStr",[["$0","value",J.Id(),0]]]]))();};}());
