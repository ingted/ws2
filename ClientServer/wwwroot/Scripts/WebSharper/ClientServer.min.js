(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I;a=self;b=a.testFrom0=a.testFrom0||{};c=b.Client=b.Client||{};d=a.StartupCode$ClientServer$Client=a.StartupCode$ClientServer$Client||{};e=a.GeneratedPrintf=a.GeneratedPrintf||{};f=a.ClientServer_JsonEncoder=a.ClientServer_JsonEncoder||{};g=a.ClientServer_JsonDecoder=a.ClientServer_JsonDecoder||{};h=a.WebSharper;i=h&&h.UI;j=i&&i.Next;k=j&&j.Var;l=h&&h.Html;m=l&&l.Client;n=m&&m.Tags;o=h&&h.Concurrency;p=h&&h.Owin;q=p&&p.WebSocket;r=q&&q.Client;s=r&&r.WithEncoding;t=a.JSON;u=a.IntelliFactory;v=u&&u.Runtime;w=h&&h.Utils;x=a.jQuery;y=h&&h.Strings;z=h&&h.Arrays;A=j&&j.Submitter;B=j&&j.View;C=h&&h.Remoting;D=C&&C.AjaxRemotingProvider;E=h&&h.MatchFailureException;F=j&&j.Doc;G=j&&j.AttrProxy;H=h&&h.ClientSideJson;I=H&&H.Provider;c.Send=function(J){var K,L;function M(N){return N(function(O){k.Set(c.filterResult(),c.filterResult().c.concat([O+"\n"]));K.Dom.appendChild(self.document.createTextNode(O+"\n"));});}K=n.Tags().NewTag("pre",[]);o.Start((L=null,o.Delay(function(){return o.Bind(s.ConnectStateful(function(N){return t.stringify((f.j())(N));},function(N){return(g.j())(t.parse(N));},J,function(){var N;N=null;return o.Delay(function(){return o.Return([0,function(O){return function(P){var Q;Q=null;return o.Delay(function(){var R;return P.$==3?(M(function(S){return S("WebSocket connection closed.");}),o.Return(O)):P.$==2?(M(function(S){return S("WebSocket connection open.");}),o.Return(O)):P.$==1?(M(function(S){return S("WebSocket connection error!");}),o.Return(O)):(R=P.$0,o.Combine(R.$==3?(((M(v.Curried3(function(S,T,U){return S("MessageFromServer_String "+w.toSafe(T)+" \r\n(state: "+a.String(U)+")");})))(R.$0))(O),o.Zero()):(M(function(S){return S("invalidMessage");}),o.Zero()),o.Delay(function(){return o.Return(O+1);})));});};}]);});}),function(N){N.Post({$:3,$0:"kickOff"});return o.Zero();});})),null);K.HtmlProvider.SetAttribute(K.get_Body(),"id","console");return K;};c.WS=function(J){var K,L;function M(N){return N(function(O){K.Dom.appendChild(self.document.createTextNode(O+"\n"));});}K=n.Tags().NewTag("pre",[]);o.Start((L=null,o.Delay(function(){var N;M(function(O){return O("Checking regression #4...");});x.ajax((N={},N.url="/ws.txt",N.method="GET",N.success=function(O){return(M(function(P){return function(Q){return P(w.toSafe(Q));};}))(O);},N.error=function(O,P,Q){return(M(function(R){return function(S){return R("KO: "+w.toSafe(S)+".");};}))(Q);},N));return o.Bind(s.ConnectStateful(function(O){return t.stringify((f.j())(O));},function(O){return(g.j())(t.parse(O));},J,function(){var O;O=null;return o.Delay(function(){return o.Return([0,function(P){return function(Q){var R;R=null;return o.Delay(function(){var S;return Q.$==3?(M(function(T){return T("WebSocket connection closed.");}),o.Return(P)):Q.$==2?(M(function(T){return T("WebSocket connection open.");}),o.Return(P)):Q.$==1?(M(function(T){return T("WebSocket connection error!");}),o.Return(P)):(S=Q.$0,o.Combine(S.$==0?(((M(v.Curried3(function(T,U,V){return T("Response2 "+a.String(U)+" (state: "+a.String(V)+")");})))(S.$0))(P),o.Zero()):S.$==2?((M(function(T){return function(U){return T("Resp3 "+e.p(U));};}))(S.$0),o.Zero()):S.$==3?((M(function(T){return function(U){return T("MessageFromServer_String "+w.prettyPrint(U));};}))(S.$0),o.Zero()):(((M(v.Curried3(function(T,U,V){return T("Response1 "+w.toSafe(U)+" (state: "+a.String(V)+")");})))(S.$0))(P),o.Zero()),o.Delay(function(){return o.Return(P+1);})));});};}]);});}),function(O){var P;P=O.get_Connection();return o.While(function(){return true;},o.Delay(function(){return o.Bind(o.Sleep(1000),function(){P.send(t.stringify((f.j())({$:2,$0:{name:{"first-name":"John00",LastName:"Doe"},age:42}})));return o.Zero();});}));});})),null);return K;};c.fsiCmd=function(){var J,K,L,M,N,O,P,Q,R;J=k.Create$1("");K=k.Create$1([]);L=k.Lens(c.filterResult(),function(S){var T;T=new a.RegExp(c.filterKeyWord().c);return y.concat(",",z.filter(function(U){return T.test(U);},S));},function(S,T){return S.concat([T]);});M=k.Create$1("named script");N=k.Create$1(0);O=A.CreateOption(J.v);P=A.CreateOption(K.v);Q=B.MapAsync(function(S){var T,U;return S!=null&&S.$==1?(T=S.$0,(k.Set(K,K.c.concat([T])),k.Set(N,N.c+1),(new D.New()).Async("ClientServer:testFrom0.Server.fsiExecute:-1840423385",[T]))):(U=null,o.Delay(function(){return o.Return("");}));},O.view);B.MapAsync(function(S){var T,U;if(S!=null&&S.$==1){if(z.length(S.$0)===0)return(new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);else if(S!=null&&S.$==1){T=S.$0;U=null;return o.Delay(function(){return o.Return(T);});}else throw new E.New("Client.fs",142,33);}else return(new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);},P.view);R=F.Input([G.Create("id","fKW"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","1")],c.filterKeyWord()).on("blur",function(){return x("#filteredResult").val(L.RVal());});return F.Element("div",[],[F.Element("div",[],[F.Button("Send",[],function(){O.Trigger();}),F.Button("Clear Console",[],function(){x("#console").empty();}),F.Button("Clear Command",[],function(){x("#fsiCmd").val("");}),F.Button("Last Command",[],function(){var S;o.Start((S=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getHisCmd:-447555547",[]),function(T){x("#fsiCmd").val(T);return o.Zero();});})),null);}),F.Button("Previous Command",[],function(){var S;z.length(K.c)===0?o.Start((S=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]),function(T){k.Set(K,T);return o.Combine(z.length(K.c)>0?(k.Set(N,z.length(K.c)-1),o.Zero()):o.Zero(),o.Delay(function(){k.Set(J,z.get(K.c,N.c));return o.Zero();}));});})),null):(N.c===0?k.Set(N,z.length(K.c)-1):k.Set(N,N.c-1),k.Set(J,z.get(K.c,N.c)));P.Trigger();}),F.Button("Get Script",[],function(){var S;o.Start((S=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.getNamedScript:-1840423385",[a.String(x("#nScript").val())]),function(T){x("#fsiCmd").val(T);return o.Zero();});})),null);}),F.Button("Save Script",[],function(){var S;o.Start((S=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.upsertNamedScript:2040152023",[a.String(x("#nScript").val()),a.String(x("#fsiCmd").val())]),function(T){x("#fsiCmd").val(T);return o.Zero();});})),null);}),F.Button("List Script",[],function(){var S;o.Start((S=null,o.Delay(function(){return o.Bind((new D.New()).Async("ClientServer:testFrom0.Server.listNamedScripts:-118046996",[]),function(T){var U;U=z.fold(function(V,W){return V!==""?V+"\r\n"+W:W;},"",T);x("#nScript").val("");x("#fsiCmd").val(U);return o.Zero();});})),null);}),F.Button("Clear Result Cache",[],function(){k.Set(c.filterResult(),[]);}),F.Element("br",[],[]),R,F.InputArea([G.Create("id","nScript"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","1")],M),F.InputArea([G.Create("id","fsiCmd"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","10"),G.Create("value","printfn \"orz\"")],J)]),F.Element("hr",[],[]),F.InputArea([G.Create("id","filteredResult"),G.Create("style","width: 880px"),G.Create("class","input"),G.Create("rows","10")],L),F.Element("h4",[G.Create("class","text-muted")],[F.TextNode("The server responded:")]),F.Element("div",[],[F.Element("h1",[],[F.TextView(Q)])])]);};c.filterKeyWord=function(){d.$cctor();return d.filterKeyWord;};c.filterResult=function(){d.$cctor();return d.filterResult;};c.m2=function(){var J,K,L;J=k.Create$1("orz");K=B.Map(function(M){return(function(N){return function(O){return N("You entered "+a.String(O)+" characters.");};}(a.id))(M);},B.Map(y.length,J.v));L=F.BindView(function(M){return F.Concat(z.map(function(N){return F.Element("li",[],[F.TextNode(N)]);},M));},B.Map(function(M){return y.SplitChars(M,[" "],0);},J.v));return F.Element("div",[],[F.Element("div",[],[F.Input([],J),F.TextView(K)]),F.Element("div",[],[F.TextNode("You entered the following words:"),F.Element("ul",[],[L])])]);};c.Main=function(){var J,K,L;J=k.Create$1("");K=A.CreateOption(J.v);L=B.MapAsync(function(M){var N;return M!=null&&M.$==1?(new D.New()).Async("ClientServer:testFrom0.Server.DoSomething:-1840423385",[M.$0]):(N=null,o.Delay(function(){return o.Return("");}));},K.view);F.RunById("navbar",F.Element("div",[],[F.TextNode("This goes into #main.")]));return F.Element("div",[],[F.Input([],J),F.Button("Send",[],function(){K.Trigger();}),F.Element("hr",[],[]),F.Element("h4",[G.Create("class","text-muted")],[F.TextNode("The server responded:")]),F.Element("div",[G.Create("class","jumbotron")],[F.Element("h1",[],[F.TextView(L)])])]);};d.$cctor=function(){d.$cctor=a.ignore;d.filterResult=k.Create$1([]);d.filterKeyWord=k.Create$1("");};e.p=function(J){return"{"+("FirstName = "+w.prettyPrint(J["first-name"]))+"; "+("LastName = "+w.prettyPrint(J.LastName))+"}";};f.j=function(){return f._v?f._v:f._v=(I.EncodeUnion(void 0,{cmd:3,age:2,"int":1,str:0},[["Request1",[["$0","str",I.EncodeArray(I.Id()),0]]],["Request2",[["$0","int",I.EncodeArray(I.Id()),0]]],["Req3",[[null,true,I.Id()]]],["MessageFromClient",[["$0","cmd",I.Id(),0]]]]))();};g.j=function(){return g._v?g._v:g._v=(I.DecodeUnion(void 0,"type",[["int",[["$0","value",I.Id(),0]]],["string",[["$0","value",I.Id(),0]]],["name",[["$0","value",I.Id(),0]]],["msgStr",[["$0","value",I.Id(),0]]]]))();};}());
