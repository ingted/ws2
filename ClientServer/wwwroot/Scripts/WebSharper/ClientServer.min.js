(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H;a=self;b=a.testFrom0=a.testFrom0||{};c=b.Client=b.Client||{};d=a.GeneratedPrintf=a.GeneratedPrintf||{};e=a.ClientServer_JsonEncoder=a.ClientServer_JsonEncoder||{};f=a.ClientServer_JsonDecoder=a.ClientServer_JsonDecoder||{};g=a.WebSharper;h=g&&g.Html;i=h&&h.Client;j=i&&i.Tags;k=g&&g.Concurrency;l=g&&g.Owin;m=l&&l.WebSocket;n=m&&m.Client;o=n&&n.WithEncoding;p=a.JSON;q=a.IntelliFactory;r=q&&q.Runtime;s=g&&g.Utils;t=a.jQuery;u=g&&g.UI;v=u&&u.Next;w=v&&v.Var;x=v&&v.Submitter;y=v&&v.View;z=g&&g.Remoting;A=z&&z.AjaxRemotingProvider;B=g&&g.Arrays;C=g&&g.MatchFailureException;D=v&&v.Doc;E=v&&v.AttrProxy;F=g&&g.Strings;G=g&&g.ClientSideJson;H=G&&G.Provider;c.Send=function(I){var J,K;function L(M){return M(function(N){J.Dom.appendChild(self.document.createTextNode(N+"\n"));});}J=j.Tags().NewTag("pre",[]);k.Start((K=null,k.Delay(function(){return k.Bind(o.ConnectStateful(function(M){return p.stringify((e.j())(M));},function(M){return(f.j())(p.parse(M));},I,function(){var M;M=null;return k.Delay(function(){return k.Return([0,function(N){return function(O){var P;P=null;return k.Delay(function(){var Q;return O.$==3?(L(function(R){return R("WebSocket connection closed.");}),k.Return(N)):O.$==2?(L(function(R){return R("WebSocket connection open.");}),k.Return(N)):O.$==1?(L(function(R){return R("WebSocket connection error!");}),k.Return(N)):(Q=O.$0,k.Combine(Q.$==3?(((L(r.Curried3(function(R,S,T){return R("MessageFromServer_String "+s.toSafe(S)+" \r\n(state: "+a.String(T)+")");})))(Q.$0))(N),k.Zero()):(L(function(R){return R("invalidMessage");}),k.Zero()),k.Delay(function(){return k.Return(N+1);})));});};}]);});}),function(M){M.Post({$:3,$0:"kickOff"});return k.Zero();});})),null);J.HtmlProvider.SetAttribute(J.get_Body(),"id","console");return J;};c.WS=function(I){var J,K;function L(M){return M(function(N){J.Dom.appendChild(self.document.createTextNode(N+"\n"));});}J=j.Tags().NewTag("pre",[]);k.Start((K=null,k.Delay(function(){var M;L(function(N){return N("Checking regression #4...");});t.ajax((M={},M.url="/ws.txt",M.method="GET",M.success=function(N){return(L(function(O){return function(P){return O(s.toSafe(P));};}))(N);},M.error=function(N,O,P){return(L(function(Q){return function(R){return Q("KO: "+s.toSafe(R)+".");};}))(P);},M));return k.Bind(o.ConnectStateful(function(N){return p.stringify((e.j())(N));},function(N){return(f.j())(p.parse(N));},I,function(){var N;N=null;return k.Delay(function(){return k.Return([0,function(O){return function(P){var Q;Q=null;return k.Delay(function(){var R;return P.$==3?(L(function(S){return S("WebSocket connection closed.");}),k.Return(O)):P.$==2?(L(function(S){return S("WebSocket connection open.");}),k.Return(O)):P.$==1?(L(function(S){return S("WebSocket connection error!");}),k.Return(O)):(R=P.$0,k.Combine(R.$==0?(((L(r.Curried3(function(S,T,U){return S("Response2 "+a.String(T)+" (state: "+a.String(U)+")");})))(R.$0))(O),k.Zero()):R.$==2?((L(function(S){return function(T){return S("Resp3 "+d.p(T));};}))(R.$0),k.Zero()):R.$==3?((L(function(S){return function(T){return S("MessageFromServer_String "+s.prettyPrint(T));};}))(R.$0),k.Zero()):(((L(r.Curried3(function(S,T,U){return S("Response1 "+s.toSafe(T)+" (state: "+a.String(U)+")");})))(R.$0))(O),k.Zero()),k.Delay(function(){return k.Return(O+1);})));});};}]);});}),function(N){var O;O=N.get_Connection();return k.While(function(){return true;},k.Delay(function(){return k.Bind(k.Sleep(1000),function(){O.send(p.stringify((e.j())({$:2,$0:{name:{"first-name":"John00",LastName:"Doe"},age:42}})));return k.Zero();});}));});})),null);return J;};c.fsiCmd=function(){var I,J,K,L,M,N,O;I=w.Create$1("");J=w.Create$1([]);K=w.Create$1("named script");L=w.Create$1(0);M=x.CreateOption(I.v);N=x.CreateOption(J.v);O=y.MapAsync(function(P){var Q,R;return P!=null&&P.$==1?(Q=P.$0,(w.Set(J,J.c.concat([Q])),w.Set(L,L.c+1),(new A.New()).Async("ClientServer:testFrom0.Server.fsiExecute:-1840423385",[Q]))):(R=null,k.Delay(function(){return k.Return("");}));},M.view);y.MapAsync(function(P){var Q,R;if(P!=null&&P.$==1){if(B.length(P.$0)===0)return(new A.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);else if(P!=null&&P.$==1){Q=P.$0;R=null;return k.Delay(function(){return k.Return(Q);});}else throw new C.New("Client.fs",107,33);}else return(new A.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]);},N.view);return D.Element("div",[],[D.Element("div",[],[D.Button("Send",[],function(){M.Trigger();}),D.Button("Clear Console",[],function(){t("#console").empty();}),D.Button("Clear Command",[],function(){t("#fsiCmd").val("");}),D.Button("Last Command",[],function(){var P;k.Start((P=null,k.Delay(function(){return k.Bind((new A.New()).Async("ClientServer:testFrom0.Server.getHisCmd:-447555547",[]),function(Q){t("#fsiCmd").val(Q);return k.Zero();});})),null);}),D.Button("Previous Command",[],function(){var P;B.length(J.c)===0?k.Start((P=null,k.Delay(function(){return k.Bind((new A.New()).Async("ClientServer:testFrom0.Server.getHisCmds:-118046996",[]),function(Q){w.Set(J,Q);return k.Combine(B.length(J.c)>0?(w.Set(L,B.length(J.c)-1),k.Zero()):k.Zero(),k.Delay(function(){w.Set(I,B.get(J.c,L.c));return k.Zero();}));});})),null):(L.c===0?w.Set(L,B.length(J.c)-1):w.Set(L,L.c-1),w.Set(I,B.get(J.c,L.c)));N.Trigger();}),D.Button("Get Script",[],function(){var P;k.Start((P=null,k.Delay(function(){return k.Bind((new A.New()).Async("ClientServer:testFrom0.Server.getNamedScript:-1840423385",[a.String(t("#nScript").val())]),function(Q){t("#fsiCmd").val(Q);return k.Zero();});})),null);}),D.Button("Save Script",[],function(){var P;k.Start((P=null,k.Delay(function(){return k.Bind((new A.New()).Async("ClientServer:testFrom0.Server.upsertNamedScript:2040152023",[a.String(t("#nScript").val()),a.String(t("#fsiCmd").val())]),function(Q){t("#fsiCmd").val(Q);return k.Zero();});})),null);}),D.Element("br",[],[]),D.InputArea([E.Create("id","nScript"),E.Create("style","width: 880px"),E.Create("class","input"),E.Create("rows","1")],K),D.InputArea([E.Create("id","fsiCmd"),E.Create("style","width: 880px"),E.Create("class","input"),E.Create("rows","10"),E.Create("value","printfn \"orz\"")],I)]),D.Element("hr",[],[]),D.Element("h4",[E.Create("class","text-muted")],[D.TextNode("The server responded:")]),D.Element("div",[],[D.Element("h1",[],[D.TextView(O)])])]);};c.m2=function(){var I,J,K;I=w.Create$1("orz");J=y.Map(function(L){return(function(M){return function(N){return M("You entered "+a.String(N)+" characters.");};}(a.id))(L);},y.Map(F.length,I.v));K=D.BindView(function(L){return D.Concat(B.map(function(M){return D.Element("li",[],[D.TextNode(M)]);},L));},y.Map(function(L){return F.SplitChars(L,[" "],0);},I.v));return D.Element("div",[],[D.Element("div",[],[D.Input([],I),D.TextView(J)]),D.Element("div",[],[D.TextNode("You entered the following words:"),D.Element("ul",[],[K])])]);};c.Main=function(){var I,J,K;I=w.Create$1("");J=x.CreateOption(I.v);K=y.MapAsync(function(L){var M;return L!=null&&L.$==1?(new A.New()).Async("ClientServer:testFrom0.Server.DoSomething:-1840423385",[L.$0]):(M=null,k.Delay(function(){return k.Return("");}));},J.view);D.RunById("navbar",D.Element("div",[],[D.TextNode("This goes into #main.")]));return D.Element("div",[],[D.Input([],I),D.Button("Send",[],function(){J.Trigger();}),D.Element("hr",[],[]),D.Element("h4",[E.Create("class","text-muted")],[D.TextNode("The server responded:")]),D.Element("div",[E.Create("class","jumbotron")],[D.Element("h1",[],[D.TextView(K)])])]);};d.p=function(I){return"{"+("FirstName = "+s.prettyPrint(I["first-name"]))+"; "+("LastName = "+s.prettyPrint(I.LastName))+"}";};e.j=function(){return e._v?e._v:e._v=(H.EncodeUnion(void 0,{cmd:3,age:2,"int":1,str:0},[["Request1",[["$0","str",H.EncodeArray(H.Id()),0]]],["Request2",[["$0","int",H.EncodeArray(H.Id()),0]]],["Req3",[[null,true,H.Id()]]],["MessageFromClient",[["$0","cmd",H.Id(),0]]]]))();};f.j=function(){return f._v?f._v:f._v=(H.DecodeUnion(void 0,"type",[["int",[["$0","value",H.Id(),0]]],["string",[["$0","value",H.Id(),0]]],["name",[["$0","value",H.Id(),0]]],["msgStr",[["$0","value",H.Id(),0]]]]))();};}());
