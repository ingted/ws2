(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v;a=self;b=a.WebSharper=a.WebSharper||{};c=b.Owin=b.Owin||{};d=c.WebSocket=c.WebSocket||{};e=d.Test=d.Test||{};f=e.Client=e.Client||{};g=a.WebSharper$Owin$WebSocket$Test_JsonEncoder=a.WebSharper$Owin$WebSocket$Test_JsonEncoder||{};h=a.WebSharper$Owin$WebSocket$Test_JsonDecoder=a.WebSharper$Owin$WebSocket$Test_JsonDecoder||{};i=b&&b.Html;j=i&&i.Client;k=j&&j.Tags;l=b&&b.Concurrency;m=a.jQuery;n=b&&b.Utils;o=d&&d.Client;p=o&&o.WithEncoding;q=a.JSON;r=a.IntelliFactory;s=r&&r.Runtime;t=b&&b.Arrays;u=b&&b.ClientSideJson;v=u&&u.Provider;f.WS=function(w){var x,y;function z(A){return A(function(B){x.Dom.appendChild(self.document.createTextNode(B+"\n"));});}x=k.Tags().NewTag("pre",[]);l.Start((y=null,l.Delay(function(){var A;z(function(B){return B("Checking regression #4...");});m.ajax((A={},A.url="/ws.txt",A.method="GET",A.success=function(B){return(z(function(C){return function(D){return C(n.toSafe(D));};}))(B);},A.error=function(B,C,D){return(z(function(E){return function(F){return E("KO: "+n.toSafe(F)+".");};}))(D);},A));return l.Bind(p.ConnectStateful(function(B){return q.stringify((g.j())(B));},function(B){return(h.j())(q.parse(B));},w,function(){var B;B=null;return l.Delay(function(){return l.Return([0,function(C){return function(D){var E;E=null;return l.Delay(function(){var F;return D.$==3?(z(function(G){return G("WebSocket connection closed.");}),l.Return(C)):D.$==2?(z(function(G){return G("WebSocket connection open.");}),l.Return(C)):D.$==1?(z(function(G){return G("WebSocket connection error!");}),l.Return(C)):(F=D.$0,l.Combine(F.$==0?(((z(s.Curried3(function(G,H,I){return G("Response2 "+a.String(H)+" (state: "+a.String(I)+")");})))(F.$0))(C),l.Zero()):(((z(s.Curried3(function(G,H,I){return G("Response1 "+n.toSafe(H)+" (state: "+a.String(I)+")");})))(F.$0))(C),l.Zero()),l.Delay(function(){return l.Return(C+1);})));});};}]);});}),function(B){var C;t.create(1000,"HELLO");C=t.create(1000,123);return l.While(function(){return true;},l.Delay(function(){return l.Bind(l.Sleep(1000),function(){B.Post({$:0,$0:["HELLO"]});return l.Bind(l.Sleep(1000),function(){B.Post({$:1,$0:C});return l.Zero();});});}));});})),null);return x;};g.j=function(){return g._v?g._v:g._v=(v.EncodeUnion(void 0,{"int":1,str:0},[["Request1",[["$0","str",v.EncodeArray(v.Id()),0]]],["Request2",[["$0","int",v.EncodeArray(v.Id()),0]]]]))();};h.j=function(){return h._v?h._v:h._v=(v.DecodeUnion(void 0,"type",[["int",[["$0","value",v.Id(),0]]],["string",[["$0","value",v.Id(),0]]]]))();};}());
