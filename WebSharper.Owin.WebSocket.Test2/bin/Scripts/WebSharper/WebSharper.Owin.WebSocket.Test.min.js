(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E;a=self;b=a.testFrom0=a.testFrom0||{};c=b.Client=b.Client||{};d=a.WebSharper$Owin$WebSocket$Test_JsonEncoder=a.WebSharper$Owin$WebSocket$Test_JsonEncoder||{};e=a.WebSharper$Owin$WebSocket$Test_JsonDecoder=a.WebSharper$Owin$WebSocket$Test_JsonDecoder||{};f=a.WebSharper;g=f&&f.Html;h=g&&g.Client;i=h&&h.Tags;j=f&&f.Concurrency;k=a.jQuery;l=f&&f.Utils;m=f&&f.Owin;n=m&&m.WebSocket;o=n&&n.Client;p=o&&o.WithEncoding;q=a.JSON;r=a.IntelliFactory;s=r&&r.Runtime;t=f&&f.Arrays;u=f&&f.UI;v=u&&u.Next;w=v&&v.Var;x=v&&v.Submitter;y=v&&v.View;z=f&&f.Remoting;A=z&&z.AjaxRemotingProvider;B=v&&v.Doc;C=v&&v.AttrProxy;D=f&&f.ClientSideJson;E=D&&D.Provider;c.WS=function(F){var G,H;function I(J){return J(function(K){G.Dom.appendChild(self.document.createTextNode(K+"\n"));});}G=i.Tags().NewTag("pre",[]);j.Start((H=null,j.Delay(function(){var J;I(function(K){return K("Checking regression #4...");});k.ajax((J={},J.url="/ws.txt",J.method="GET",J.success=function(K){return(I(function(L){return function(M){return L(l.toSafe(M));};}))(K);},J.error=function(K,L,M){return(I(function(N){return function(O){return N("KO: "+l.toSafe(O)+".");};}))(M);},J));return j.Bind(p.ConnectStateful(function(K){return q.stringify((d.j())(K));},function(K){return(e.j())(q.parse(K));},F,function(){var K;K=null;return j.Delay(function(){return j.Return([0,function(L){return function(M){var N;N=null;return j.Delay(function(){var O;return M.$==3?(I(function(P){return P("WebSocket connection closed.");}),j.Return(L)):M.$==2?(I(function(P){return P("WebSocket connection open.");}),j.Return(L)):M.$==1?(I(function(P){return P("WebSocket connection error!");}),j.Return(L)):(O=M.$0,j.Combine(O.$==0?(((I(s.Curried3(function(P,Q,R){return P("Response2 "+a.String(Q)+" (state: "+a.String(R)+")");})))(O.$0))(L),j.Zero()):(((I(s.Curried3(function(P,Q,R){return P("Response1 "+l.toSafe(Q)+" (state: "+a.String(R)+")");})))(O.$0))(L),j.Zero()),j.Delay(function(){return j.Return(L+1);})));});};}]);});}),function(K){var L;t.create(1000,"HELLO");L=t.create(1000,123);return j.While(function(){return true;},j.Delay(function(){return j.Bind(j.Sleep(1000),function(){K.Post({$:0,$0:["HELLO"]});return j.Bind(j.Sleep(1000),function(){K.Post({$:1,$0:L});return j.Zero();});});}));});})),null);return G;};c.Main=function(){var F,G,H;F=w.Create$1("");G=x.CreateOption(F.v);H=y.MapAsync(function(I){var J;return I!=null&&I.$==1?(new A.New()).Async("WebSharper.Owin.WebSocket.Test:testFrom0.Server.DoSomething:-1840423385",[I.$0]):(J=null,j.Delay(function(){return j.Return("");}));},G.view);return B.Element("div",[],[B.Input([],F),B.Button("Send",[],function(){G.Trigger();}),B.Element("hr",[],[]),B.Element("h4",[C.Create("class","text-muted")],[B.TextNode("The server responded:")]),B.Element("div",[C.Create("class","jumbotron")],[B.Element("h1",[],[B.TextView(H)])])]);};d.j=function(){return d._v?d._v:d._v=(E.EncodeUnion(void 0,{"int":1,str:0},[["Request1",[["$0","str",E.EncodeArray(E.Id()),0]]],["Request2",[["$0","int",E.EncodeArray(E.Id()),0]]]]))();};e.j=function(){return e._v?e._v:e._v=(E.DecodeUnion(void 0,"type",[["int",[["$0","value",E.Id(),0]]],["string",[["$0","value",E.Id(),0]]]]))();};}());
